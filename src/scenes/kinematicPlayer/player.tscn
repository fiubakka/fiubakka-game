[gd_scene load_steps=34 format=3 uid="uid://b0ckgcsol4ucx"]

[ext_resource type="Script" path="res://src/scenes/kinematicPlayer/player.gd" id="1_j2141"]
[ext_resource type="Texture2D" uid="uid://b73nn4usjai1f" path="res://art/player/char_a_p1_0bas_humn_v01.png" id="2_psolp"]

[sub_resource type="AtlasTexture" id="AtlasTexture_66aeg"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 64, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_d8st0"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 0, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_6o7h1"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 192, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_dmu6m"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 128, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_40ehy"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_5d8gf"]
atlas = ExtResource("2_psolp")
region = Rect2(64, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_bqgr7"]
atlas = ExtResource("2_psolp")
region = Rect2(128, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ia3up"]
atlas = ExtResource("2_psolp")
region = Rect2(192, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_dj6ww"]
atlas = ExtResource("2_psolp")
region = Rect2(256, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_3swil"]
atlas = ExtResource("2_psolp")
region = Rect2(320, 256, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_8q26v"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_u4og4"]
atlas = ExtResource("2_psolp")
region = Rect2(64, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_7tca5"]
atlas = ExtResource("2_psolp")
region = Rect2(128, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_6qi68"]
atlas = ExtResource("2_psolp")
region = Rect2(192, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_cay5h"]
atlas = ExtResource("2_psolp")
region = Rect2(256, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_15n65"]
atlas = ExtResource("2_psolp")
region = Rect2(320, 448, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_umgxn"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_0ok3s"]
atlas = ExtResource("2_psolp")
region = Rect2(64, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ikwbd"]
atlas = ExtResource("2_psolp")
region = Rect2(128, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_twsik"]
atlas = ExtResource("2_psolp")
region = Rect2(192, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_e8t0v"]
atlas = ExtResource("2_psolp")
region = Rect2(256, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_sy5og"]
atlas = ExtResource("2_psolp")
region = Rect2(320, 384, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_7rbr1"]
atlas = ExtResource("2_psolp")
region = Rect2(0, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_vawhh"]
atlas = ExtResource("2_psolp")
region = Rect2(64, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_rul78"]
atlas = ExtResource("2_psolp")
region = Rect2(128, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_p6fvb"]
atlas = ExtResource("2_psolp")
region = Rect2(192, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_ohggr"]
atlas = ExtResource("2_psolp")
region = Rect2(256, 320, 64, 64)

[sub_resource type="AtlasTexture" id="AtlasTexture_lc1rn"]
atlas = ExtResource("2_psolp")
region = Rect2(320, 320, 64, 64)

[sub_resource type="SpriteFrames" id="SpriteFrames_v8327"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_66aeg")
}],
"loop": true,
"name": &"idle_back",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_d8st0")
}],
"loop": false,
"name": &"idle_front",
"speed": 1.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_6o7h1")
}],
"loop": true,
"name": &"idle_left",
"speed": 1.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_dmu6m")
}],
"loop": true,
"name": &"idle_right",
"speed": 1.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_40ehy")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5d8gf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_bqgr7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ia3up")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dj6ww")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3swil")
}],
"loop": true,
"name": &"walk_down",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_8q26v")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_u4og4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7tca5")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6qi68")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cay5h")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_15n65")
}],
"loop": true,
"name": &"walk_left",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_umgxn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_0ok3s")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ikwbd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_twsik")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_e8t0v")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_sy5og")
}],
"loop": true,
"name": &"walk_right",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_7rbr1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_vawhh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rul78")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_p6fvb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ohggr")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lc1rn")
}],
"loop": true,
"name": &"walk_up",
"speed": 10.0
}]

[sub_resource type="GDScript" id="GDScript_r82dr"]
script/source = "extends AnimatedSprite2D

signal change_velocity

@export var idle: bool = true
@export var speed = 400 # How fast the player will move (pixels/sec).
var screen_size # Size of the game window.
var velocity = Vector2.ZERO # The player's movement vector.
var prev_vel = Vector2.ZERO
var id = null

var collision_inputs = {}
var should_update_move_counter = 0

# Called when the node enters the scene tree for the first time.
func _ready():
	#$TCPPeer.update_player_pos.connect(_on_tcp_peer_update_player_pos)
	pass

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	should_update_move_counter += delta
	
	if (Input.is_action_just_pressed(\"open_chat\")):
		idle = true
	if (Input.is_action_just_pressed(\"close_chat\")):
		idle = false
	if (idle): return
	
	velocity = Vector2.ZERO
	if (Input.is_action_pressed(\"move_right\") and !(collision_inputs.has(\"move_right\"))):
		velocity.x = 1
	if (Input.is_action_pressed(\"move_left\") and !(collision_inputs.has(\"move_left\"))):
		velocity.x = -1
	if (Input.is_action_pressed(\"move_up\") and !(collision_inputs.has(\"move_up\"))):
		velocity.y = -1
	if (Input.is_action_pressed(\"move_down\") and !(collision_inputs.has(\"move_down\"))):
		velocity.y = 1
		
	if (Input.is_action_just_released(\"move_left\") or Input.is_action_just_released(\"move_right\")):
		velocity.x = 0
		velocity = velocity.normalized()
		change_velocity.emit(velocity)
	if (Input.is_action_just_released(\"move_down\") or Input.is_action_just_released(\"move_up\")):
		velocity.y = 0
		velocity = velocity.normalized()
		change_velocity.emit(velocity)
	if (Input.is_action_just_released(\"move_right\") or Input.is_action_just_released(\"move_left\")):
		velocity.x = 0
		velocity = velocity.normalized()
		change_velocity.emit(velocity)
	
	
	if velocity != Vector2.ZERO and should_update_move_counter > 0.01666:
		should_update_move_counter = 0
		velocity = velocity.normalized()
		change_velocity.emit(velocity)
	
	play_move_animation(velocity, prev_vel)
	prev_vel = velocity

func play_move_animation(velocity, prev_vel):
	if (velocity.x > 0):
		$AnimatedSprite2D.play(\"walk_right\")
	elif (velocity.x < 0):
		$AnimatedSprite2D.play(\"walk_left\")
	elif (velocity.y < 0):
		$AnimatedSprite2D.play(\"walk_up\")
	elif (velocity.y > 0):
		$AnimatedSprite2D.play(\"walk_down\")
	else:
		if (prev_vel.x > 0):
			$AnimatedSprite2D.play(\"idle_right\")
		elif (prev_vel.x < 0):
			$AnimatedSprite2D.play(\"idle_left\")
		elif (prev_vel.y < 0):
			$AnimatedSprite2D.play(\"idle_back\")
		elif (prev_vel.y > 0):
			$AnimatedSprite2D.play(\"idle_front\")


func _on_main_set_player_id(id):
	self.id = id


func _on_tcp_peer_update_player_pos(position):
	self.position = position


func _on_area_entered(area):
	for i in range(area.get_child_count()):
		var collision_node = area.get_child(i)
		var collision_direction = collision_node.get_meta(\"collision_direction\")
		match int(collision_direction.x):
			1:
				collision_inputs[\"move_right\"] = collision_node
			-1:
				collision_inputs[\"move_left\"] = collision_node
		match int(collision_direction.y):
			1:
				collision_inputs[\"move_down\"] = collision_node
			-1:
				collision_inputs[\"move_up\"] = collision_node
		if (collision_direction.x != 0):
			velocity.x = 0
		if (collision_direction.y != 0):
			velocity.y = 0
		velocity = velocity.normalized()
		change_velocity.emit(velocity)


func _on_area_exited(area):
	for i in range(area.get_child_count()):
		var collision_node = area.get_child(i)
		for key in collision_inputs:
			if (collision_inputs[key] == collision_node):
				collision_inputs.erase(key)
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_6hhbj"]
size = Vector2(55, 22)

[node name="CharacterBody2D" type="CharacterBody2D"]
position = Vector2(20, 20)
scale = Vector2(0.5, 0.5)
script = ExtResource("1_j2141")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
texture_filter = 1
scale = Vector2(3.917, 3.485)
sprite_frames = SubResource("SpriteFrames_v8327")
animation = &"idle_front"
script = SubResource("GDScript_r82dr")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-2.5, 33)
shape = SubResource("RectangleShape2D_6hhbj")

[node name="Camera2D" type="Camera2D" parent="."]

[node name="Name" type="RichTextLabel" parent="."]
offset_left = -26.0
offset_top = -92.0
offset_right = 26.0
offset_bottom = -69.0
bbcode_enabled = true
text = "[center][b]You[/b][/center]"
fit_content = true
